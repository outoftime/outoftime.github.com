---
title: Sunspot Rails Search TKTK
layout: slideshow
---

<div id="slideShow">
  <div class="title">
    <h1>Awesome Rails search with Solr and Sunspot</h1>
    <h3>Mat Brown</h3>
    <h3>Pivotal Labs Tech Talks</h3>
    <h3>16 March 2010</h3>
  </div>
  <div class="list">
    <h1>The Road to Victory</h1>
    <ul>
      <li>Get up and running with Sunspot::Rails &mdash; it's easy!</li>
      <li>How Solr works</li>
      <li>Exploring Sunspot and Solr's search features</li>
      <li>Sunspot in production</li>
    </ul>
  </div>
  <div class="title">
    <h1>Let's get started!</h1>
  </div>
  <div>
    <h1>Install Sunspot</h1>
    <p>Install the gem(s):</p>
    <pre><code># gem install sunspot-rails</code></pre>
    <p>Generate the config file:</p>
    <pre><code>$ script/generate sunspot</code></pre>
  </div>
  <div>
    <h1>Start Solr</h1>
    <pre><code>$ rake sunspot:solr:start</code></pre>
    <p>This creates some files and directories in your Rails root:</p>
    <pre><code>solr/conf/solrconfig.xml
solr/conf/schema.xml
solr/data/</code></pre>
    <p>You can edit the XML files to customize Solr's behavior.</p>
  </div>
  <div>
    <h1>Index your data</h1>
    <p>Make your model searchable:</p>
    <pre><code>class Post &lt; ActiveRecord::Base
  searchable do
    text :title, :body
  end
end</code></pre>
    <p>Add your data to Solr:</p>
    <pre><code>$ rake sunspot:reindex</code></pre>
    <p>You only need to do that once.</p>
  </div>
  <div>
    <h1>Add search to your app</h1>
    <p>Create a controller action:</p>
    <pre><code>class PostsController &lt; ApplicationController
  def search
    @search = Post.search do
      keywords(params[:q])
    end
  end
end</code></pre>
  </div>
  <div>
    <h1>Add search to your app</h1>
    <p>Output your results:</p>
    <pre><code>.results
  - @search.results.each do |post|
    .result
      %h1= h(post.title)
      %p= h(truncate(post.body))

.pagination= will_paginate(@search.results)</code></pre>
  </div>
  <div class="title"><h1>That was easy.</h1></div>
  <div class="title"><h1>So what is this Solr thing?</h1></div>
  <div>
    <p class="definition">
      Solr is a standalone HTTP server that provides a
      document-oriented, inverted index of fulltext and scalar data.
    </p>
  </div>
  <div>
    <h1 class="compact">This is an inverted index.</h1>
    <p style="text-align:center"><img src="/images/inverted-index.png"/></p>
  </div>
  <div>
    <h1>Why is Solr awesome?</h1>
    <ul>
      <li>Data is indexed by your application, how you want, when you want.</li>
      <li>Standalone web service provides multiple good paths to scaling.</li>
      <li>Wildly popular and maintained by the Apache Software Foundation.</li>
    </ul>
  </div>
  <div>
    <h1 class="compact">What kind of data can Solr index?</h1>
    <ul>
      <li>Fulltext</li>
      <li>
        <p>Scalar types</p>
        <ul>
          <li>String</li>
          <li>Integer</li>
          <li>Float</li>
          <li>Time</li>
          <li>Boolean</li>
        </ul>
      </li>
      <li>Trie Fields</li>
    </ul>
  </div>
  <div>
    <h1>Attribute Fields in Sunspot</h1>
    <pre><code>class Post &lt; ActiveRecord::Base
  belongs_to :blog
  has_and_belongs_to_many :categories

  searchable do
    integer :blog_id
    integer :category_ids, :multiple =&gt; true
    time :published_at, :trie =&gt; true
  end
end</code></pre>
  </div>
  <div>
    <h1>Attribute Field Scoping</h1>
    <p>Match a value exactly:</p>
    <pre><code>with(:blog_id, 1)</code></pre>
  </div>
  <div>
    <h1>Attribute Field Scoping</h1>
    <p>Match by inequality:</p>
    <pre><code>with(:published_at).less_than(Time.now)</code></pre>
  </div>
  <div>
    <h1>Attribute Field Scoping</h1>
    <p>Match by multiple values:</p>
    <pre><code>with(:category_ids).any_of([1, 3, 5])</code></pre>
  </div>
  <div>
    <h1>Attribute Field Scoping</h1>
    <p>Match with a range:</p>
    <pre><code>with(:published_at).between(
  Time.parse('2010-01-01')..Time.parse('2010-02-01')
)</code></pre>
  </div>
  <div>
    <h1>Attribute Field Scoping</h1>
    <p>Combine restrictions with connectives:</p>
    <pre><code>any_of do
  with(:expired_at).greater_than(Time.now)
  with(:expired_at, nil)
end</code></pre>
  </div>
  <div>
    <h1>Attribute Field Scoping</h1>
    <p>Exclude specific instances from results:</p>
    <pre><code>without(current_post)</code></pre>
  </div>
</div>
